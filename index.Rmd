---
title: WHAT ARE THE REASONS BEHIND THE RECENT EVOLUTIONS IN THE SPANISH POLITICAL
  SYSTEM?
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library, message=FALSE, echo=FALSE, include=FALSE}
devtools::install_github("rstudio/flexdashboard")
library(pxR)
library(MicroDatosEs)
library(XML)
library(zoo)
library(rvest)
library(dplyr)
library(magrittr)
library(foreign)
library(readxl)
library(ggplot2)
library(pastecs)
library(stargazer)
library(gplots)
library(car)
library(plotly)
```

```{r dataset, message=FALSE, echo=FALSE}
Spain_data <- read.csv("https://raw.githubusercontent.com/schmuziger/Final-Data-Project/master/spain_data.csv")
```

The Spanish parliament had a dramatic change in its composition in a short period of time. Going from a bi-party system dominated by the PP - center-right - and the PSOE - center-left- until 2011, new parties - Podemos and Ciudadanos - gained strength during the Euro-crisis and managed to become relevant forces in the country's political system in 2015. Here you can find an overview of socio-economic data that help explaining part of that change. The aim of the project is to see whether youth unemployment had any impact on voter turnout rates, leading to the abovementioned change. We hope you enjoy our data vizualization skills!

-------------------------------------

### Turnout vs. Youth unemployment, per region 

```{r regions2, message=FALSE, echo=FALSE}
p <- ggplot(Spain_data, aes(Unempl_rate_less25, Turnout))
p1<-p + geom_point(aes(colour = Region_code)) 
p3 <- p1 + labs(y="Turnout", x= "Youth Unemployment")
p5 <- p3 + scale_y_continuous("Voter Turnout",
                              limits=c(0.4,0.85),
                              breaks=seq(0.4, 0.85, 0.2)) + stat_smooth(method = 'lm', aes(colour = Region_code), se = FALSE)
p6<-p5 + theme(axis.text.x = element_blank())
p6
```

Row
-------------------------------------
    
### Turnout vs. Youth Unemployment
    
```{r regions, message=FALSE, echo=FALSE}
e <- plot_ly(Spain_data, x = ~Year, y = ~Turnout, text = ~paste("Turnout: ", Turnout), mode = "markers", color = ~Unempl_rate_less25, size = ~Unempl_rate_less25, opacity = ~Unempl_rate_less25)

e1 <- layout(e, title = 'Turnout and Youth Unemployment over time')

e1
```

###Youth unemployment vs. Regions

```{r unemployment, message=FALSE, echo=FALSE}
d2004 <- subset(Spain_data, Year <= 2004)
d2008 <- subset(Spain_data, Year <= 2008 & Year>2004)
d2011 <- subset(Spain_data, Year <= 2011 & Year>2008)
d2015 <- subset(Spain_data, Year <= 20015 & Year>2011)

trace_2004 <- rnorm(d2004$Region_code, d2004$Unempl_rate_less25)
trace_2008 <- rnorm(d2008$Region_code, d2008$Unempl_rate_less25)
trace_2011 <- rnorm(d2011$Region_code, d2011$Unempl_rate_less25)
trace_2015 <- rnorm(d2015$Region_code, d2015$Unempl_rate_less25)
Unemployment <- rnorm(d2004$Region_code, d2004$Unempl_rate_less25)
x <- c(d2004$Region_code)

data <- data.frame(x, trace_2004, trace_2008, trace_2011, trace_2015)

a <- plot_ly(data, Region = ~x, y = ~Unemployment, name = '2004', type = 'scatter', mode = 'lines')%>%add_trace(y = ~trace_2008, name = '2008', mode = 'lines')%>%add_trace(y = ~trace_2011, name ='2011', mode = 'lines')%>%add_trace(y = ~trace_2015, name = '2015', mode = 'lines')

a <- layout(a, title = 'Youth Unemployment in different regions in Spain over time')

a
```
